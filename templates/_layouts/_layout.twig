<!DOCTYPE html>
<html lang="en" class="h-full no-js">
<script>document.documentElement.classList.remove('no-js');</script>
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  
  {# Disable CSP in development to avoid blocking localhost #}
  {% if not craft.app.config.general.devMode %}
    <meta http-equiv="Content-Security-Policy" content="script-src 'self' 'unsafe-inline' 'unsafe-eval' https:; connect-src 'self' https:; img-src 'self' data: https:; style-src 'self' 'unsafe-inline' https:;">
  {% endif %}
  
  {# Performance optimizations #}
  <link rel="dns-prefetch" href="//fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <meta name="theme-color" content="#f3f4f6">

  <title>{% if title is defined %}{{ title }} - {% endif %}{{ siteName }}</title>
  
  {# SEO Meta Tags #}
  {% if metaDescription is defined %}
    <meta name="description" content="{{ metaDescription }}">
  {% endif %}
  
  {# Favicon #}
  <link rel="icon" type="image/x-icon" href="/favicon.ico">
 
  {# Load assets based on environment and Vite plugin availability #}
  {% if craft.plugins.isPluginEnabled('vite') %}
    {# Vite plugin is available - use it for both dev and production #}
    {# Load CSS synchronously (false) to avoid FOUC since we have critical CSS #}
    {{ craft.vite.script("src/js/app.js", false) }}
  {% else %}
    {# Fallback when Vite plugin is not available #}
    {% if craft.app.config.general.devMode %}
      {# Development mode - load from Vite dev server #}
      <script type="module" src="{{ craft.app.config.custom.viteDevServerPublic ?: 'http://localhost:3000' }}/@vite/client"></script>
      <script type="module" src="{{ craft.app.config.custom.viteDevServerPublic ?: 'http://localhost:3000' }}/src/js/app.js"></script>
    {% else %}
      {# Production mode - load built assets manually #}
      {% set manifest = craft.app.assetManager.getPublishedPath('@webroot/.vite/manifest.json') %}
      {% if manifest and manifest|file_exists %}
        {% set manifestData = manifest|file_get_contents|json_decode %}
        {% if manifestData['src/js/app.js'] is defined %}
          {% set entry = manifestData['src/js/app.js'] %}
          <script type="module" src="/{{ entry.file }}"></script>
          {% if entry.css is defined %}
            {% for cssFile in entry.css %}
              <link rel="stylesheet" href="/{{ cssFile }}">
            {% endfor %}
          {% endif %}
        {% endif %}
      {% endif %}
    {% endif %}
  {% endif %}

  {# Critical CSS to prevent FOUC - inline in head #}
  <style>
    /* Critical path CSS inserted during server-side rendering */
    html.loading body {
      opacity: 0;
    }
    body {
      background-color: #f3f4f6; /* bg-gray-100 equivalent */
      opacity: 1;
      transition: opacity 0.3s ease-in-out;
    }
  </style>
  
  {# Add loading class and remove it when DOM is ready #}
  <script>
    document.documentElement.classList.add('loading');
    document.addEventListener('DOMContentLoaded', function () {
      setTimeout(function () {
        document.documentElement.classList.remove('loading');
      }, 50);
    });
  </script>
  {# Alpine.js is now bundled in app.js for both dev and production #}
  
</head>
<body class="flex flex-col min-h-screen bg-gray-100">

  {# Skip navigation link for accessibility #}
  <a href="#main-content" class="sr-only focus:not-sr-only focus:absolute focus:top-4 focus:left-4 bg-blue-600 text-white px-4 py-2 rounded-md z-50">
    Skip to main content
  </a>

  {# Header #}
  <header class="bg-white shadow-sm">
    <nav class="container-custom py-4">
      <div class="flex items-center justify-between">
        <div class="flex items-center space-x-4">
          <a href="/" class="text-2xl font-bold text-gray-800">
            {{ siteName }}
          </a>
        </div>
        
        {# Mobile menu button #}
        <div class="md:hidden" x-data="{ open: false }">
          <button @click="open = !open" class="text-gray-600 hover:text-gray-900">
            <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path>
            </svg>
          </button>
          
          {# Mobile menu #}
          <div x-show="open" x-transition class="absolute top-16 left-0 right-0 bg-white shadow-lg md:hidden">
            <div class="px-4 py-2 space-y-2">
              <a href="/" class="block py-2 text-gray-600 hover:text-gray-900">Home</a>
              <a href="/admin" class="block py-2 text-gray-600 hover:text-gray-900">Admin</a>
            </div>
          </div>
        </div>
        
        {# Desktop menu #}
        <div class="hidden md:flex space-x-8">
          <a href="/" class="text-gray-600 hover:text-gray-900 transition-colors">Home</a>
          <a href="/admin" class="text-gray-600 hover:text-gray-900 transition-colors">Admin</a>
        </div>
      </div>
    </nav>
  </header>

  {# Main content #}
  <main id="main-content" class="flex-1">
    {% block content %}{% endblock %}
  </main>

  {# Footer #}
  <footer class="bg-gray-800 text-white">
    <div class="container-custom py-8">
      <div class="grid grid-cols-1 md:grid-cols-3 gap-8">
        <div>
          <h3 class="text-lg font-semibold mb-4">{{ siteName }}</h3>
          <p class="text-gray-300">
            A modern Craft CMS boilerplate with Vite, TailwindCSS, and Alpine.js.
          </p>
        </div>
        <div>
          <h3 class="text-lg font-semibold mb-4">Quick Links</h3>
          <ul class="space-y-2 text-gray-300">
            <li><a href="/" class="hover:text-white transition-colors">Home</a></li>
            <li><a href="/admin" class="hover:text-white transition-colors">Admin Panel</a></li>
            <li><a href="https://craftcms.com/docs" class="hover:text-white transition-colors" target="_blank" rel="noopener">Documentation</a></li>
          </ul>
        </div>
        <div>
          <h3 class="text-lg font-semibold mb-4">Development</h3>
          <div class="text-gray-300 space-y-2">
            <p>Built with Craft CMS 5</p>
            <p>Vite + TailwindCSS + Alpine.js</p>
            <p class="text-sm text-gray-400 mt-4">Ready for customization!</p>
          </div>
        </div>
      </div>
      <div class="border-t border-gray-700 mt-8 pt-8 text-center text-gray-300">
        <p>&copy; {{ "now"|date("Y") }} {{ siteName }}. All rights reserved.</p>
      </div>
    </div>
  </footer>

</body>
</html>
